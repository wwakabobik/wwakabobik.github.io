<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Making AI chatbot to hear and speak</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="https://wwakabobik.github.io/2023/09/ai_learning_to_hear_and_speak/" rel="canonical" />
  <!-- Feed -->
        <link href="https://wwakabobik.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="wwakabobik's lair Full Atom Feed" />
          <link href="https://wwakabobik.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="wwakabobik's lair Full RSS Feed" />
          <link href="https://wwakabobik.github.io/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="wwakabobik's lair Atom Feed" />
          <link href="https://wwakabobik.github.io/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="wwakabobik's lair RSS Feed" />
          <link href="https://wwakabobik.github.io/feeds/ai.atom.xml" type="application/atom+xml" rel="alternate" title="wwakabobik's lair Categories Atom Feed" />
          <link href="https://wwakabobik.github.io/feeds/ai.rss.xml" type="application/rss+xml" rel="alternate" title="wwakabobik's lair Categories RSS Feed" />

  <link href="https://wwakabobik.github.io/theme/css/style.css" type="text/css" rel="stylesheet" />


    <!-- Custom fonts -->
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="Learning to interact with chatbots in a natural way. How to make a bot speak and listen using Python">

    <meta name="author" content="wwakabobik">

    <meta name="tags" content="ai">
    <meta name="tags" content="tts">
    <meta name="tags" content="transcribe">
    <meta name="tags" content="asyncio">
    <meta name="tags" content="threading">




<!-- Open Graph -->
<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="wwakabobik's lair"/>
<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Making AI chatbot to hear and speak"/>
<meta prefix="og: http://ogp.me/ns#" property="og:description" content="Learning to interact with chatbots in a natural way. How to make a bot speak and listen using Python"/>
<meta prefix="og: http://ogp.me/ns#" property="og:locale" content="en_US"/>
<meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://wwakabobik.github.io/2023/09/ai_learning_to_hear_and_speak/"/>
<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article"/>
<meta prefix="og: http://ogp.me/ns#" property="article:published_time" content="2023-09-07 11:08:00+02:00"/>
<meta prefix="og: http://ogp.me/ns#" property="article:modified_time" content="2025-04-17 21:17:41.723730+02:00"/>
<meta prefix="og: http://ogp.me/ns#" property="article:author" content="https://wwakabobik.github.io/author/wwakabobik/">
  <meta prefix="og: http://ogp.me/ns#" property="article:publisher" content="https://www.facebook.com/wwakabobik" />
<meta prefix="og: http://ogp.me/ns#" property="article:section" content="ai"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="ai"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="tts"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="transcribe"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="asyncio"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="threading"/>
<meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://wwakabobik.github.io/assets/images/bg/ai.png">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Making AI chatbot to hear and speak",
  "headline": "Making AI chatbot to hear and speak",
  "datePublished": "2023-09-07 11:08:00+02:00",
  "dateModified": "2025-04-17 21:17:41.723730+02:00",
  "author": {
    "@type": "Person",
    "name": "wwakabobik",
    "url": "https://wwakabobik.github.io/author/wwakabobik/"
  },
  "image": "https://wwakabobik.github.io/assets/images/bg/ai.png",
  "url": "https://wwakabobik.github.io/2023/09/ai_learning_to_hear_and_speak/",
  "description": "Learning to interact with chatbots in a natural way. How to make a bot speak and listen using Python"
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>
          <li><a href="/" role="presentation">Home</a></li>
          <li><a href="/tag/index.html" role="presentation">Tags</a></li>
          <li><a href="/category/index.html" role="presentation">Categories</a></li>
          <li><a href="/archive/index.html" role="presentation">Archives</a></li>

              <li role="presentation"><a href="https://wwakabobik.github.io/pages/about/">About</a></li>

    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" class="has-cover">
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="https://wwakabobik.github.io/" aria-label="Home" title="Home">
                  <i class="ic ic-arrow-left" aria-hidden="true"></i>
                  <span>Home</span>
                </a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button" aria-label="Menu">
              <i class="ic ic-menu" aria-hidden="true"></i>
              <span>Menu</span>
            </a>
          </span>
        </nav>
        <h1 class="post-title">Making AI chatbot to hear and speak</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="https://wwakabobik.github.io/author/wwakabobik/">Iliya Vereshchagin</a>
            | <time datetime="07 Sep 2023">07 Sep 2023</time>
        </span>
            <div class="post-cover cover" style="background-image: url('https://wwakabobik.github.io/assets/images/bg/ai.png')">
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p>I really like the concept when you can expand the possibilities of perception for artificial intelligence. Today, the chat format is the most understandable and popular for interacting with AI. Of course, communication only through chat warms my introverted soul, brought up on <a class="reference external" href="https://en.wikipedia.org/wiki/FidoNet">BBS</a> and stories about <a class="reference external" href="http://www.bofharchive.com/">BOFH</a>. But, nevertheless, why not make communication with bots more human, teach them to listen, hear and speak? Everything that will be discussed further in the article is not some kind of unique killer-feature, and has been used in many services that provide access to artificial intelligence, for example, in <a class="reference external" href="https://ablt.ai/">aBLT.ai</a> chats. In this article, I want to talk about a Python solution available to anyone.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Ph7EQSZPmGc?si=2AgO98dUN2ihiVW-" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe><div class="section" id="transcriptions">
<h2>Transcriptions</h2>
<div class="section" id="openai-audio-transcribe">
<h3>openai.Audio.transcribe</h3>
<p>You are most likely using ChatGPT as your main LLM engine. If you turn to its <a class="reference external" href="https://platform.openai.com/docs/introduction">API</a>, you can find a special <strong>whisper-1</strong> model, which is also responsible for text transcription. All you need to do to transcribe your voice into text is call the <strong>openai.Audio.atranscribe method</strong>. Here and below, I will use asynchronous methods where possible. This is more convenient for implementing parallel execution and running.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openai</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">transcript</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for the transcribe function. Returns only the content of the message.</span>

<span class="sd">    :param file: Path with filename to transcript.</span>
<span class="sd">    :param prompt: Previous prompt. Default is None.</span>
<span class="sd">    :param language: Language on which audio is. Default is &#39;en&#39;.</span>
<span class="sd">    :param response_format: default response format, by default is &#39;text&#39;.</span>
<span class="sd">                           Possible values are: json, text, srt, verbose_json, or vtt.</span>


<span class="sd">    :return: transcription (text, json, srt, verbose_json or vtt)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">prompt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">openai</span><span class="o">.</span><span class="n">Audio</span><span class="o">.</span><span class="n">atranscribe</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;whisper-1&quot;</span><span class="p">,</span>
        <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
        <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
        <span class="n">response_format</span><span class="o">=</span><span class="n">response_format</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
<p>To call this function, we just pass a file to it.</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">transcript</span> <span class="o">=</span> <span class="k">await</span> <span class="n">transcript</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ask_chat</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>  <span class="c1"># this method is for prompting LLM using pure string</span>
</pre></div>
<p>Using a pre-made file is fine, but for the sake of completeness: is it worth assuming that you probably want to record your voice on the fly?</p>
</div>
<div class="section" id="recording-audio-sounddevice">
<h3>Recording audio: sounddevice</h3>
<p>The easiest way is to use <strong>sounddevice</strong>. Since <strong>sounddevice</strong> records a file in <strong>wav</strong> format, it is reasonable to convert it to <strong>mp3</strong> for transmission over the Internet, for this you can use, for example, <strong>pydab</strong>. As a result, the code will look something like this:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">uuid</span>

<span class="kn">import</span> <span class="nn">sounddevice</span> <span class="k">as</span> <span class="nn">sd</span>
<span class="kn">import</span> <span class="nn">soundfile</span> <span class="k">as</span> <span class="nn">sf</span>
<span class="kn">from</span> <span class="nn">pydub</span> <span class="kn">import</span> <span class="n">AudioSegment</span>


<span class="k">def</span> <span class="nf">record_and_convert_audio</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">frequency_sample</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16000</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Records audio for a specified duration and converts it to MP3 format.</span>

<span class="sd">This function records audio for a given duration (in seconds) with a specified frequency sample.</span>
<span class="sd">The audio is then saved as a temporary .wav file, converted to .mp3 format, and the .wav file is deleted.</span>
<span class="sd">The function returns the path to the .mp3 file.</span>

<span class="sd">:param duration: The duration of the audio recording in seconds. Default is 5 seconds.</span>
<span class="sd">:param frequency_sample: The frequency sample rate of the audio recording. Default is 16000 Hz.</span>

<span class="sd">:return: The path to the saved .mp3 file.</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Listening beginning for </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">s...&quot;</span><span class="p">)</span>
    <span class="n">recording</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">rec</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">frequency_sample</span><span class="p">),</span> <span class="n">samplerate</span><span class="o">=</span><span class="n">frequency_sample</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sd</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>  <span class="c1"># Wait until recording is finished</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recording complete!&quot;</span><span class="p">)</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
    <span class="n">wave_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span><span class="si">}</span><span class="s2">.wav&quot;</span>
    <span class="n">sf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wave_file</span><span class="p">,</span> <span class="n">recording</span><span class="p">,</span> <span class="n">frequency_sample</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Temp audiofile saved: </span><span class="si">{</span><span class="n">wave_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="o">.</span><span class="n">from_wav</span><span class="p">(</span><span class="n">wave_file</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">wave_file</span><span class="p">)</span>
    <span class="n">mp3_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span><span class="si">}</span><span class="s2">.mp3&quot;</span>
    <span class="n">audio</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">mp3_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mp3&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio converted to MP3 and stored into </span><span class="si">{</span><span class="n">mp3_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mp3_file</span>
</pre></div>
<p>The resulting file can already be fed to the model. But the method looks very clumsy, because the recording continues for a fixed time, no matter how long you speak - less than the set interval and you have to wait for the end of the recording; or more, which will lead to the phrase being cut off. Usually the smartest solution is to implement push-to-talk. While the user presses the button, the recording is in progress. This is how instant messengers and many online chats work.</p>
</div>
<div class="section" id="recording-audio-audiorecorder">
<h3>Recording audio: AudioRecorder</h3>
<p>But I still don't think it's smart enough, because it doesn't fit with the concept of AI having ears. As a console user, it would be more convenient for me to make an implementation without any buttons and keyboard interactions, and always it's better to assign this task to the code. That is: listen constantly, and if speech is noticed in the noise, then recognize it. Well, almost like how Google Assistant, Siri, and smart speakers work in your home. If you don't need to respond to any sound, you can always filter your catch phrase to be recognized first (at the start of the recording).</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;hellos*,?s*bunny&quot;</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">transcript</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ask_chat</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
</pre></div>
<p>Well, for this task you can use for example my <strong>AudioRecorder</strong> based on <strong>pyaudio</strong>. It will listen to the microphone and detect noise (speech) against the background of silence using the <strong>RMS</strong> (Root Mean Square) method. Full implementation below.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">wave</span>

<span class="kn">import</span> <span class="nn">pyaudio</span>
<span class="kn">from</span> <span class="nn">pydub</span> <span class="kn">import</span> <span class="n">AudioSegment</span>


<span class="k">class</span> <span class="nc">AudioRecorder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The AudioRecorder class is for managing an instance of the audio recording and conversion process.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    pyaudio_obj (PyAudio): Instance of PyAudio. Default is pyaudio.PyAudio().</span>
<span class="sd">    threshold (int): The RMS threshold for starting the recording. Default is 15.</span>
<span class="sd">    channels (int): The number of channels in the audio stream. Default is 1.</span>
<span class="sd">    chunk (int): The number of frames per buffer. Default is 1024.</span>
<span class="sd">    f_format (int): The format of the audio stream. Default is pyaudio.paInt16.</span>
<span class="sd">    rate (int): The sample rate of the audio stream. Default is 16000 Hz.</span>
<span class="sd">    sample_width (int): The sample width (in bytes) of the audio stream. Default is 2.</span>
<span class="sd">    timeout_length (int): The length of the timeout for the recording (in seconds). Default is 2 seconds.</span>
<span class="sd">    temp_dir (str): The directory for storing the temporary .wav and .mp3 files. Default is the system&#39;s temporary dir.</span>
<span class="sd">    normalize (float): The normalization factor for the audio samples. Default is 1.0 / 32768.0.</span>
<span class="sd">    pa_input (bool): Specifies whether the stream is an input stream. Default is True.</span>
<span class="sd">    pa_output (bool): Specifies whether the stream is an output stream. Default is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pyaudio_obj</span><span class="o">=</span><span class="n">pyaudio</span><span class="o">.</span><span class="n">PyAudio</span><span class="p">(),</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">chunk</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">f_format</span><span class="o">=</span><span class="n">pyaudio</span><span class="o">.</span><span class="n">paInt16</span><span class="p">,</span>
        <span class="n">rate</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>
        <span class="n">sample_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">timeout_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">temp_dir</span><span class="o">=</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span>
        <span class="n">normalize</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">32768.0</span><span class="p">),</span>
        <span class="n">pa_input</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">pa_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General init.</span>

<span class="sd">        This method initializes an instance of the AudioRecorder class with the specified parameters.</span>
<span class="sd">        The default values are used for any parameters that are not provided.</span>

<span class="sd">        :param pyaudio_obj: Instance of PyAudio. Default is pyaudio.PyAudio().</span>
<span class="sd">        :param threshold: The RMS threshold for starting the recording. Default is 15.</span>
<span class="sd">        :param channels: The number of channels in the audio stream. Default is 1.</span>
<span class="sd">        :param chunk: The number of frames per buffer. Default is 1024.</span>
<span class="sd">        :param f_format: The format of the audio stream. Default is pyaudio.paInt16.</span>
<span class="sd">        :param rate: The sample rate of the audio stream. Default is 16000 Hz.</span>
<span class="sd">        :param sample_width: The sample width (in bytes) of the audio stream. Default is 2.</span>
<span class="sd">        :param timeout_length: The length of the timeout for the recording (in seconds). Default is 2 seconds.</span>
<span class="sd">        :param temp_dir: The directory for storing the temporary .wav and .mp3 files. Default is temp dir.</span>
<span class="sd">        :param normalize: The normalization factor for the audio samples. Default is 1.0 / 32768.0.</span>
<span class="sd">        :param pa_input: Specifies whether the stream is an input stream. Default is True.</span>
<span class="sd">        :param pa_output: Specifies whether the stream is an output stream. Default is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___pyaudio</span> <span class="o">=</span> <span class="n">pyaudio_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___channels</span> <span class="o">=</span> <span class="n">channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___chunk</span> <span class="o">=</span> <span class="n">chunk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___format</span> <span class="o">=</span> <span class="n">f_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___rate</span> <span class="o">=</span> <span class="n">rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___sample_width</span> <span class="o">=</span> <span class="n">sample_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___timeout_length</span> <span class="o">=</span> <span class="n">timeout_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___temp_dir</span> <span class="o">=</span> <span class="n">temp_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___normalize</span> <span class="o">=</span> <span class="n">normalize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___input</span> <span class="o">=</span> <span class="n">pa_input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___output</span> <span class="o">=</span> <span class="n">pa_output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_stream</span><span class="p">(</span>
            <span class="n">f_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">___format</span><span class="p">,</span>
            <span class="n">channels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">___channels</span><span class="p">,</span>
            <span class="n">rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">___rate</span><span class="p">,</span>
            <span class="n">pa_input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">___input</span><span class="p">,</span>
            <span class="n">pa_output</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">___output</span><span class="p">,</span>
            <span class="n">frames_per_buffer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">___chunk</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_format</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">pa_input</span><span class="p">,</span> <span class="n">pa_output</span><span class="p">,</span> <span class="n">frames_per_buffer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an audio stream with the specified parameters.</span>

<span class="sd">        This function uses PyAudio to open an audio stream with the given format, channels, rate, input, output,</span>
<span class="sd">        and frames per buffer.</span>

<span class="sd">        :param f_format: The format of the audio stream.</span>
<span class="sd">        :param channels: The number of channels in the audio stream.</span>
<span class="sd">        :param rate: The sample rate of the audio stream.</span>
<span class="sd">        :param pa_input: Specifies whether the stream is an input stream. A true value indicates an input stream.</span>
<span class="sd">        :param pa_output: Specifies whether the stream is an output stream. A true value indicates an output stream.</span>
<span class="sd">        :param frames_per_buffer: The number of frames per buffer.</span>
<span class="sd">        :type frames_per_buffer: int</span>

<span class="sd">        :return: The initialized audio stream.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">___pyaudio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">f_format</span><span class="p">,</span>
            <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">,</span>
            <span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">pa_input</span><span class="p">,</span>
            <span class="n">output</span><span class="o">=</span><span class="n">pa_output</span><span class="p">,</span>
            <span class="n">frames_per_buffer</span><span class="o">=</span><span class="n">frames_per_buffer</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts recording audio when noise is detected.</span>

<span class="sd">        This function starts recording audio when noise above a certain threshold is detected.</span>
<span class="sd">        The recording continues for a specified timeout length.</span>
<span class="sd">        The recorded audio is then saved as a .wav file, converted to .mp3 format, and the .wav file is deleted.</span>
<span class="sd">        The function returns the path to the .mp3 file.</span>

<span class="sd">        :return: The path to the saved .mp3 file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Noise detected, recording beginning&quot;</span><span class="p">)</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">___timeout_length</span>

        <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___chunk</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">___threshold</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">___timeout_length</span>

            <span class="n">current</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rec</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_mp3</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recording</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the recorded audio to a .wav file.</span>

<span class="sd">        This function saves the recorded audio to a .wav file with a unique filename.</span>
<span class="sd">        The .wav file is saved in the specified temporary directory.</span>

<span class="sd">        :param recording: The recorded audio data.</span>

<span class="sd">        :return: The path to the saved .wav file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___temp_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span><span class="si">}</span><span class="s2">.wav&quot;</span><span class="p">)</span>

        <span class="n">wave_form</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">wave_form</span><span class="o">.</span><span class="n">setnchannels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___channels</span><span class="p">)</span>
        <span class="n">wave_form</span><span class="o">.</span><span class="n">setsampwidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___pyaudio</span><span class="o">.</span><span class="n">get_sample_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___format</span><span class="p">))</span>
        <span class="n">wave_form</span><span class="o">.</span><span class="n">setframerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___rate</span><span class="p">)</span>
        <span class="n">wave_form</span><span class="o">.</span><span class="n">writeframes</span><span class="p">(</span><span class="n">recording</span><span class="p">)</span>
        <span class="n">wave_form</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">filename</span>

    <span class="k">def</span> <span class="nf">convert_to_mp3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a .wav file to .mp3 format.</span>

<span class="sd">        This function converts a .wav file to .mp3 format. The .wav file is deleted after the conversion.</span>
<span class="sd">        The .mp3 file is saved with a unique filename in the specified temporary directory.</span>

<span class="sd">        :param filename: The path to the .wav file to be converted.</span>

<span class="sd">        :return: The path to the saved .mp3 file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">audio</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="o">.</span><span class="n">from_wav</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">mp3_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___temp_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span><span class="si">}</span><span class="s2">.mp3&quot;</span><span class="p">)</span>
        <span class="n">audio</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">mp3_file_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mp3&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mp3_file_path</span>

    <span class="k">def</span> <span class="nf">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts listening for audio.</span>

<span class="sd">        This function continuously listens for audio and starts recording when the</span>
<span class="sd">        RMS value of the audio exceeds a certain threshold.</span>

<span class="sd">        :return: The path to the saved .mp3 file if recording was triggered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Listening beginning...&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">mic_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___chunk</span><span class="p">)</span>
            <span class="n">rms_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms</span><span class="p">(</span><span class="n">mic_input</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rms_val</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">___threshold</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">rms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the Root Mean Square (RMS) value of the audio frame.</span>

<span class="sd">        This function calculates the RMS value of the audio frame, which is a measure of the power in the audio signal.</span>

<span class="sd">        :param frame: The audio frame for which to calculate the RMS value.</span>

<span class="sd">        :return: The RMS value of the audio frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">___sample_width</span>
        <span class="n">f_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">h&quot;</span> <span class="o">%</span> <span class="n">count</span>
        <span class="n">shorts</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">f_format</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="n">sum_squares</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">shorts</span><span class="p">:</span>
            <span class="n">normal_sample</span> <span class="o">=</span> <span class="n">sample</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">___normalize</span>
            <span class="n">sum_squares</span> <span class="o">+=</span> <span class="n">normal_sample</span> <span class="o">*</span> <span class="n">normal_sample</span>
        <span class="n">rms</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">sum_squares</span> <span class="o">/</span> <span class="n">count</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rms</span> <span class="o">*</span> <span class="mi">1000</span>
</pre></div>
<p>You may need to experiment with the <em>threshold</em>, <em>timeout</em>, <em>channels</em>, <em>sample_length</em>, <em>chunk</em>, and <em>rate</em> parameters depending on your microphone. And finally, the code to get use as for &quot;ears&quot; of bot.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils.audio_recorder</span> <span class="kn">import</span> <span class="n">AudioRecorder</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="n">AudioRecorder</span><span class="p">()</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="speech-recognition">
<h3>speech_recognition</h3>
<p>Using <strong>OpenAI</strong>'s ready-made methods is fine, but the tokens are not free, and you might want to use an alternative approach. Or this method does not suit you at all, because you use, for example, <strong>llama2</strong> or <strong>Bard</strong> instead of <strong>ChatGPT</strong>. Then an alternative solution may be to use the <strong>speech_recognition</strong> library.
I use <em>google</em> recognition, but you can use other engines if you want, like <em>wit</em>, <em>azure</em>, <em>sphinx</em>. The library has everything we need so that we can recognize both an audio file and record directly using the <strong>Microphone()</strong> class. Just like my <strong>AudioRecorder</strong>, it's convenient to use voice activation. The only thing you need to specify is the language of the audio file. Yes, this is not as flexible and convenient as in the method from OpenAI, where you can omit the language parameter and hope that the system itself will select the correct language, but I personally would recommend to specify the language you speaking in order to avoid errors. An example method might look like this:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">speech_recognition</span> <span class="k">as</span> <span class="nn">sr</span>


<span class="k">class</span> <span class="nc">CustomTranscriptor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is wrapper class for Google Transcriptor which uses microphone to get audio sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en-EN&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General init.</span>

<span class="sd">        :param language: Language, what needs to be transcripted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___recognizer</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Recognizer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">___source</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Microphone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>

        <span class="k">def</span> <span class="nf">transcript</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function transcripts audio (from microphone recording) to text using Google transcriptor.</span>

<span class="sd">    :return: transcripted text (string).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Listening beginning...&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">___source</span> <span class="k">as</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">audio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">___recognizer</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">user_input</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">___recognizer</span><span class="o">.</span><span class="n">recognize_google</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">sr</span><span class="o">.</span><span class="n">UnknownValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Google Speech Recognition can&#39;t transcript audio&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">sr</span><span class="o">.</span><span class="n">RequestError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to fetch from resource Google Speech Recognition: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">sr</span><span class="o">.</span><span class="n">WaitTimeoutError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input timeout, only silence is get: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user_input</span>
</pre></div>
<p>Finally, the code for working with chat via voice might look like this.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="kn">from</span> <span class="nn">utils.audio_recorder</span> <span class="kn">import</span> <span class="n">AudioRecorder</span>
<span class="kn">from</span> <span class="nn">utils.transcriptors</span> <span class="kn">import</span> <span class="n">CustomTranscriptor</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;google&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;google&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">AudioRecorder</span><span class="p">()</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">transcript</span> <span class="o">=</span> <span class="k">await</span> <span class="n">gpt</span><span class="o">.</span><span class="n">transcript</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">transcript</span> <span class="o">=</span> <span class="n">CustomTranscriptor</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s2">&quot;en-US&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transcript</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">transcript</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ask_chat</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">break</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="text-to-speach">
<h2>Text-to-Speach</h2>
<p>It's time to teach our artificial intelligence to speak. Unfortunately, there is no out-of-the-box solution here if you work directly with LLM. To convert text to voice, one of the TTS implementations must be used.</p>
<div class="section" id="gtts">
<h3>gtts</h3>
<p>The first option is to use the <strong>gtts</strong> library from Google. In this case, <strong>gtts</strong> will create a file with voice acting, which will need to be played in some player, and then deleted. In order not to produce entities, I use <strong>pydub.playback</strong>.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">uuid4</span>

<span class="kn">from</span> <span class="nn">gtts</span> <span class="kn">import</span> <span class="n">gTTS</span>
<span class="kn">from</span> <span class="nn">pydub</span> <span class="kn">import</span> <span class="n">AudioSegment</span><span class="p">,</span> <span class="n">playback</span>


<span class="k">def</span> <span class="nf">process_via_gtts</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
    <span class="n">tts</span> <span class="o">=</span> <span class="n">gTTS</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
    <span class="n">raw_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span><span class="si">}</span><span class="s2">.mp3&quot;</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">raw_file</span><span class="p">)</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mp3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">speedup</span><span class="p">(</span><span class="mf">1.3</span><span class="p">)</span>  <span class="c1"># haste a bit</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">raw_file</span><span class="p">)</span>
    <span class="n">playback</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="pyttsx">
<h3>pyttsx</h3>
<p>The second option is to use the <strong>pyttsx</strong> library. Unlike <strong>gtts</strong>, speech synthesis occurs on the fly in a loop, which is more convenient and faster when streaming text. And, moreover, doesn't require Internet connection.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="kn">from</span> <span class="nn">pyttsx4</span> <span class="kn">import</span> <span class="n">init</span> <span class="k">as</span> <span class="n">pyttsx_init</span>


<span class="k">def</span> <span class="nf">process_via_pytts</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts text to speach using python-tts text-to-speach method</span>

<span class="sd">    :param text: Text needs to be converted to speach.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">pyttsx_init</span><span class="p">()</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;voice&quot;</span><span class="p">,</span> <span class="s1">&#39;com.apple.voice.enhanced.ru-RU.Katya&#39;</span><span class="p">)</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">startLoop</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">engine</span><span class="o">.</span><span class="n">isBusy</span><span class="p">():</span>
        <span class="n">engine</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">engine</span><span class="o">.</span><span class="n">endLoop</span><span class="p">()</span>
</pre></div>
<p>To check which voices do you have, you may get more system voices using following code:</p>
<div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">pyttsx_init</span><span class="p">()</span>
<span class="n">engine</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s2">&quot;voices&quot;</span><span class="p">)</span>
</pre></div>
<p>Actually, to put it together, we get a response from the chat and play it through some kind of tts engine.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="kn">from</span> <span class="nn">utils.audio_recorder</span> <span class="kn">import</span> <span class="n">AudioRecorder</span>
<span class="kn">from</span> <span class="nn">utils.transcriptors</span> <span class="kn">import</span> <span class="n">CustomTranscriptor</span>
<span class="kn">from</span> <span class="nn">utils.tts</span> <span class="kn">import</span> <span class="n">process_via_gtts</span><span class="p">,</span> <span class="n">process_via_pytts</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">tts_process</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts text to speach using pre-defined model</span>

<span class="sd">    :param text: Text needs to be converted to speach.</span>
<span class="sd">    :param method: method of tts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;google&quot;</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>
        <span class="n">process_via_gtts</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">process_via_pytts</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;google&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;google&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">method</span><span class="p">:</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">AudioRecorder</span><span class="p">()</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">transcript</span> <span class="o">=</span> <span class="k">await</span> <span class="n">gpt</span><span class="o">.</span><span class="n">transcript</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">transcript</span> <span class="o">=</span> <span class="n">CustomTranscriptor</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s2">&quot;en-US&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transcript</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">transcript</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ask_chat</span><span class="p">(</span><span class="n">transcript</span><span class="p">)</span>  <span class="c1"># this method returns string of whole chatbot response</span>
                <span class="k">await</span> <span class="n">tts_process</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;not google&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">break</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="reality-and-usage-challenges">
<h2>Reality and usage challenges</h2>
<p>As in a wonderful anecdote about Chapaev: &quot;But there is one caveat&quot;. Receiving a response from the chatbot takes some time, depending on the model, it can be quite long. When using tts, we have to wait for a full response and start playing the voice, which further increases the final response time. When I first started my experiments, it ruined all the magic of live communication and caused only irritation and a desire to return to satrom-kind text communication. But it is not all that bad. To be honest, I'm in love with ChatGPT's stream method, which returns a response on the fly from <strong>ChatCompletion</strong>. So my idea is to call tts as soon as something is received in response from the bot. But those who used this feature probably know that anything can be returned - both words and sentences or individual letters. And that's a problem if you try to run tts on every chunk you get.</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chatcmpl-ABCABC&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chat.completion.chunk&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1234567890</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;choices&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;delta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hel&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;finish_reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chatcmpl-ABCABC&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chat.completion.chunk&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1234567890</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;choices&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;delta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lo, &quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;finish_reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
<span class="err">&lt;...&gt;</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chatcmpl-ABCABC&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chat.completion.chunk&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1234567890</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;choices&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;delta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ay?&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;finish_reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
<p>First iteration: let's wait for the whole word to be received, and only then start voice acting.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">utils.tts</span> <span class="kn">import</span> <span class="n">tts_process</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">ask_chat</span><span class="p">(</span><span class="n">user_input</span><span class="p">):</span>
    <span class="n">full_response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">gpt</span><span class="o">.</span><span class="n">str_chat</span><span class="p">(</span><span class="n">user_input</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">+=</span> <span class="n">char</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">whitespace</span> <span class="ow">or</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
                    <span class="n">tts_process</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>  <span class="c1"># I use direct stdout output to make output be printed on-the-fly.</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>      <span class="c1"># To get typewriter effect I forcefully flush output each time.</span>
            <span class="n">full_response</span> <span class="o">+=</span> <span class="n">char</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">full_response</span>   <span class="c1"># if we&#39;ll need whole prompt for some reasons later</span>
</pre></div>
<p>The result, to be honest, will be so-so - torn. It's probably a good idea to wait for a few words, like 2-3, and speak them out. Words will be added to an asynchronous queue and checked in a parallel running task.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">asyncio</span>

<span class="kn">from</span> <span class="nn">utils.tts</span> <span class="kn">import</span> <span class="n">tts_process</span>


<span class="n">prompt_queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">ask_chat</span><span class="p">(</span><span class="n">user_input</span><span class="p">):</span>
    <span class="n">full_response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">gpt</span><span class="o">.</span><span class="n">str_chat</span><span class="p">(</span><span class="n">user_input</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">+=</span> <span class="n">char</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">whitespace</span> <span class="ow">or</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">prompt_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>  <span class="c1"># I use direct stdout output to make output be printed on-the-fly.</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>      <span class="c1"># To get typewriter effect I forcefully flush output each time.</span>
            <span class="n">full_response</span> <span class="o">+=</span> <span class="n">char</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">full_response</span>   <span class="c1"># if we&#39;ll need whole prompt for some reasons later</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">tts_task</span><span class="p">():</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">empty_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">prompt_queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="n">empty_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">empty_counter</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">empty_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Get all available words</span>
        <span class="n">limit_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">word</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">prompt_queue</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">words</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                <span class="n">limit_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">limit_counter</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">limit</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># If we have at least limit words or queue was empty 3 times, process them</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">tts</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">tts_task</span><span class="p">())</span>
        <span class="c1"># and rest of the code</span>
</pre></div>
<p>This already sounds better, but intonation and punctuation are lost in the process of processing. Finally, let's make the assumption that only sentences should be processed, well, or parts of them, that is, pieces that will end with the characters &quot;<em>.?!,;:</em>&quot;.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">asyncio</span>

<span class="kn">from</span> <span class="nn">utils.tts</span> <span class="kn">import</span> <span class="n">tts_process</span>


<span class="n">prompt_queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">ask_chat</span><span class="p">(</span><span class="n">user_input</span><span class="p">):</span>
    <span class="n">full_response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">gpt</span><span class="o">.</span><span class="n">str_chat</span><span class="p">(</span><span class="n">user_input</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">+=</span> <span class="n">char</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">whitespace</span> <span class="ow">or</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">prompt_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>  <span class="c1"># I use direct stdout output to make output be printed on-the-fly.</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>      <span class="c1"># To get typewriter effect I forcefully flush output each time.</span>
            <span class="n">full_response</span> <span class="o">+=</span> <span class="n">char</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">full_response</span>   <span class="c1"># if we&#39;ll need whole prompt for some reasons later</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">tts_sentence_task</span><span class="p">():</span>
    <span class="n">punctuation_marks</span> <span class="o">=</span> <span class="s2">&quot;.?!,;:&quot;</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">prompt_queue</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">sentence</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">word</span>
            <span class="c1"># If the last character is a punctuation mark, process the sentence</span>
            <span class="k">if</span> <span class="n">sentence</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">punctuation_marks</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">tts_process</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
                <span class="n">sentence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">tts_sentence_task</span><span class="p">())</span>
    <span class="c1"># and rest of the code</span>
</pre></div>
<p>If you tried my examples, you will notice that the chat output is interrupted during the voiceover. To fix this, we need to run tts on a separate thread. To do this, we will need to form a second queue for tts. And start another parallel task for the handler.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">asyncio</span>

<span class="kn">from</span> <span class="nn">utils.tts</span> <span class="kn">import</span> <span class="n">tts_process</span>


<span class="n">prompt_queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
<span class="n">tts_queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">ask_chat</span><span class="p">(</span><span class="n">user_input</span><span class="p">):</span>
    <span class="c1"># same</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">tts_sentence_task</span><span class="p">():</span>
<span class="n">punctuation_marks</span> <span class="o">=</span> <span class="s2">&quot;.?!,;:&quot;</span>
<span class="n">sentence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">word</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">prompt_queue</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">sentence</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">word</span>
        <span class="c1"># If the last character is a punctuation mark, process the sentence</span>
        <span class="k">if</span> <span class="n">sentence</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">punctuation_marks</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">tts_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
            <span class="n">sentence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">tts_worker</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tts_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sentence</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">tts_process</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
            <span class="n">tts_queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">tts_sentence_task</span><span class="p">())</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">tts_worker</span><span class="p">())</span>
    <span class="c1"># and rest of the code</span>
</pre></div>
<p>And yet the task is not solved, because, alas, the methods of tts (what is <strong>gtts</strong> or <strong>pyttsx</strong>) are synchronous. This means that for the duration of voice acting, the execution of the main loop is blocked, and awaits the execution of a synchronous task. To solve this problem, you should, for example, run the players in separate threads. The easiest way to do this is using the <strong>threading</strong> library.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">threading</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">process_via_gtts</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Converts text to speach using gtts text-to-speach method</span>

<span class="sd">:param text: Text needs to be converted to speach.</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
    <span class="n">tts</span> <span class="o">=</span> <span class="n">gTTS</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
    <span class="n">raw_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span><span class="si">}</span><span class="s2">.mp3&quot;</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">raw_file</span><span class="p">)</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mp3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">speedup</span><span class="p">(</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">raw_file</span><span class="p">)</span>
    <span class="n">player_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">playback</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">audio</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">audio</span><span class="p">,))</span>
    <span class="n">player_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">tts_process</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Converts text to speach using pre-defined model</span>

<span class="sd">:param text: Text needs to be converted to speach.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">if</span> <span class="s2">&quot;google&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">___method</span><span class="p">:</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_via_gtts</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">player_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">process_via_pytts</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">text</span><span class="p">,))</span>
    <span class="n">player_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
<p>In this case, we get a new problem - now tts will be played as soon as a new offer appears in the queue. If, by the time the first sentence is spoken, the second sentence is received, then it will be played, then the third, and a cacophony will result. To avoid this, finally, you need to use the <strong>semaphore</strong> mechanism. Before going further, we'll check and wait for the release of the <strong>semaphore</strong>, and upon its completion, we release the <strong>semaphore</strong>.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">threading</span>


<span class="n">semaphore</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">play_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audio</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Service method to play audio in monopoly mode using pydub</span>

<span class="sd">    :param audio: AudioSegment needs to be played.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">playback</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
    <span class="n">semaphore</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">process_via_gtts</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts text to speach using gtts text-to-speach method</span>

<span class="sd">    :param text: Text needs to be converted to speach.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
    <span class="n">tts</span> <span class="o">=</span> <span class="n">gTTS</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">___lang</span><span class="p">)</span>
    <span class="n">raw_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span><span class="si">}</span><span class="s2">.mp3&quot;</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">raw_file</span><span class="p">)</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">AudioSegment</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">raw_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mp3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">speedup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___speedup</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">raw_file</span><span class="p">)</span>
    <span class="n">semaphore</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="n">player_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">play_audio</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">audio</span><span class="p">,))</span>
    <span class="n">player_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">process_via_pytts</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts text to speach using python-tts text-to-speach method</span>

<span class="sd">    :param text: Text needs to be converted to speach.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">___pytts</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;voice&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">___voice</span><span class="p">)</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">startLoop</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">engine</span><span class="o">.</span><span class="n">isBusy</span><span class="p">():</span>
        <span class="n">engine</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">___frame</span><span class="p">)</span>

    <span class="n">engine</span><span class="o">.</span><span class="n">endLoop</span><span class="p">()</span>
    <span class="n">semaphore</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts text to speach using pre-defined model</span>

<span class="sd">    :param text: Text needs to be converted to speach.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;google&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">___method</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__process_via_gtts</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">semaphore</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">player_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__process_via_pytts</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">text</span><span class="p">,))</span>
        <span class="n">player_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="as-a-conclusion">
<h2>As a conclusion</h2>
<p>Why is it needed? Here everyone can answer depending on their tasks and needs. I was curious to explore possible ways to implement &quot;natural communication&quot; with chatbots. For example, my bot can be a personal assistant, available at hand at any time, and behaving the way I expect it to. Well, let's say, ask on the fly to find out the current weather or draw a beautiful necromancer girl riding a white horse.</p>
<img alt="Necromancer girl riding white horse" src="/assets/images/articles/ai/learning_to_hear_and_speak/necromancer.jpg" />
</div>

            </section>

            <section class="post-info">
                <div class="post-share">
                    <a title="Twitter" aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=Making AI chatbot to hear and speak&amp;url=https://wwakabobik.github.io/2023/09/ai_learning_to_hear_and_speak/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                      <i class="ic ic-twitter" aria-hidden="true"></i><span class="hidden">Twitter</span>
                    </a>
                    <a title="Facebook" aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://wwakabobik.github.io/2023/09/ai_learning_to_hear_and_speak/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                      <i class="ic ic-facebook" aria-hidden="true"></i><span class="hidden">Facebook</span>
                    </a>
                    <a title="LinkedIn" aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://wwakabobik.github.io/2023/09/ai_learning_to_hear_and_speak/&amp;title=Making AI chatbot to hear and speak" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;">
                      <i class="ic ic-linkedin" aria-hidden="true"></i><span class="hidden">LinkedIn</span>
                    </a>
                    <a title="Email" aria-label="Email" class="email" href="mailto:?subject=Making AI chatbot to hear and speak&amp;body=https://wwakabobik.github.io/2023/09/ai_learning_to_hear_and_speak/">
                      <i class="ic ic-mail" aria-hidden="true"></i><span class="hidden">Email</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="https://wwakabobik.github.io/tag/ai/">ai</a><a href="https://wwakabobik.github.io/tag/tts/">tts</a><a href="https://wwakabobik.github.io/tag/transcribe/">transcribe</a><a href="https://wwakabobik.github.io/tag/asyncio/">asyncio</a><a href="https://wwakabobik.github.io/tag/threading/">threading</a>                </aside>

                <div class="clear"></div>

                <aside class="post-author">


                        <figure class="post-author-avatar">
                            <img src="https://wwakabobik.github.io/assets/images/authors/wwakabobik.png" alt="Iliya Vereshchagin" />
                        </figure>
                    <div class="post-author-bio">
                        <h4 class="post-author-name"><a href="https://wwakabobik.github.io/author/wwakabobik/">Iliya Vereshchagin</a></h4>
                            <p class="post-author-about">Quality is not an act, it's habit</p>
                            <span class="post-author-location"><i class="ic ic-location"></i> Serbia, Novi Sad</span>
                        <!-- Social linkes in alphabet order. -->
                            <span class="post-author-github"><a target="_blank" href="https://github.com/wwakabobik"><i class="ic ic-github"></i> GitHub</a></span>
                        <span class="post-author-instagram"><a target="_blank" href="https://www.instagram.com/i_ver"><i class="ic ic-instagram"></i> Instagram</a></span>
                        <span class="post-author-pypi"><a target="_blank" href="https://pypi.org/user/wwakabobik/"><i class="ic ic-pypi"></i> pypi</a></span>
                            <span class="post-author-linkedin"><a target="_blank" href="https://www.linkedin.com/in/wwakabobik"><i class="ic ic-linkedin"></i> LinkedIn</a></span>
                    </div>
                    <div class="clear"></div>
                </aside>

                </section>


                <aside class="post-nav">
                    <a class="post-nav-next" href="https://wwakabobik.github.io/2023/09/gaming_first_person_view_party_based_rpg/">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-left"></i>
                                <h2 class="post-nav-title">My history of first-person view party-based RPG</h2>
                            <p class="post-nav-excerpt">I love first-person view party-based RPGs. Here is a list of games I played and my...</p>
                        </section>
                    </a>
                    <a class="post-nav-prev" href="https://wwakabobik.github.io/2023/08/ai_image_generators/">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-right"></i>
                                <h2 class="post-nav-title">AI image generators</h2>
                            <p class="post-nav-excerpt">Are there alternatives for Midjourney? Can they compete with it? I am doing my...</p>
                        </section>
                    </a>
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script type="text/javascript" src="https://wwakabobik.github.io/theme/js/script.js"></script>

    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MVTS1WKZ1T"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-MVTS1WKZ1T', { 'anonymize_ip': true });
    </script>
</body>
</html>